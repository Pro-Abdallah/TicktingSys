{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/ITTickting%20Sys/lib/database/connection.ts"],"sourcesContent":["import sql from 'mssql';\r\n\r\n// Get configuration from environment variables\r\nconst server = process.env.DB_SERVER || 'DESKTOP-9M75GPK';\r\nconst database = process.env.DB_NAME || 'ElsewedySchoolSysDB_DEV';\r\nconst user = process.env.DB_USER;\r\nconst password = process.env.DB_PASSWORD;\r\n\r\nif (!user || !password) {\r\n    console.error('⚠️  Missing DB_USER or DB_PASSWORD in .env.local');\r\n    console.error('   Please add SQL Server credentials to .env.local file');\r\n}\r\n\r\nconst config: sql.config = {\r\n    server,\r\n    database,\r\n    user,\r\n    password,\r\n    options: {\r\n        encrypt: true,\r\n        trustServerCertificate: true,\r\n        enableArithAbort: true,\r\n    },\r\n    pool: {\r\n        max: 10,\r\n        min: 0,\r\n        idleTimeoutMillis: 30000\r\n    },\r\n    connectionTimeout: 30000,\r\n    requestTimeout: 30000\r\n};\r\n\r\n// Connection pool\r\nlet pool: sql.ConnectionPool | null = null;\r\n\r\n/**\r\n * Get or create database connection pool\r\n */\r\nexport async function getDbPool(): Promise<sql.ConnectionPool> {\r\n    if (pool && pool.connected) {\r\n        return pool;\r\n    }\r\n\r\n    try {\r\n        pool = await sql.connect(config);\r\n        console.log('✅ Database connected successfully');\r\n        return pool;\r\n    } catch (error) {\r\n        console.error('❌ Database connection failed:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Execute a SQL query with parameters\r\n */\r\nexport async function executeQuery<T = any>(\r\n    query: string,\r\n    params: Record<string, any> = {}\r\n): Promise<sql.IResult<T>> {\r\n    try {\r\n        const poolConnection = await getDbPool();\r\n        const request = poolConnection.request();\r\n\r\n        // Add parameters to request\r\n        for (const [key, value] of Object.entries(params)) {\r\n            request.input(key, value);\r\n        }\r\n\r\n        const result = await request.query<T>(query);\r\n        return result;\r\n    } catch (error) {\r\n        console.error('Query execution error:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Close the database connection\r\n */\r\nexport async function closeDbConnection(): Promise<void> {\r\n    if (pool) {\r\n        await pool.close();\r\n        pool = null;\r\n        console.log('Database connection closed');\r\n    }\r\n}\r\n\r\n// Export sql for type definitions\r\nexport { sql };\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,+CAA+C;AAC/C,MAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI;AACxC,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO,IAAI;AACxC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO;AAChC,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW;AAExC,IAAI,CAAC,QAAQ,CAAC,UAAU;IACpB,QAAQ,KAAK,CAAC;IACd,QAAQ,KAAK,CAAC;AAClB;AAEA,MAAM,SAAqB;IACvB;IACA;IACA;IACA;IACA,SAAS;QACL,SAAS;QACT,wBAAwB;QACxB,kBAAkB;IACtB;IACA,MAAM;QACF,KAAK;QACL,KAAK;QACL,mBAAmB;IACvB;IACA,mBAAmB;IACnB,gBAAgB;AACpB;AAEA,kBAAkB;AAClB,IAAI,OAAkC;AAK/B,eAAe;IAClB,IAAI,QAAQ,KAAK,SAAS,EAAE;QACxB,OAAO;IACX;IAEA,IAAI;QACA,OAAO,MAAM,8NAAG,CAAC,OAAO,CAAC;QACzB,QAAQ,GAAG,CAAC;QACZ,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM;IACV;AACJ;AAKO,eAAe,aAClB,KAAa,EACb,SAA8B,CAAC,CAAC;IAEhC,IAAI;QACA,MAAM,iBAAiB,MAAM;QAC7B,MAAM,UAAU,eAAe,OAAO;QAEtC,4BAA4B;QAC5B,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,QAAS;YAC/C,QAAQ,KAAK,CAAC,KAAK;QACvB;QAEA,MAAM,SAAS,MAAM,QAAQ,KAAK,CAAI;QACtC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,MAAM;IACV;AACJ;AAKO,eAAe;IAClB,IAAI,MAAM;QACN,MAAM,KAAK,KAAK;QAChB,OAAO;QACP,QAAQ,GAAG,CAAC;IAChB;AACJ"}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/ITTickting%20Sys/lib/database/index.ts"],"sourcesContent":["// Re-export connection utilities for backward compatibility\r\nexport { getDbPool, executeQuery, closeDbConnection, sql } from './connection';\r\n"],"names":[],"mappings":"AAAA,4DAA4D;;AAC5D"}},
    {"offset": {"line": 331, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Downloads/ITTickting%20Sys/app/api/test-db/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { executeQuery } from '@/lib/database';\r\n\r\nexport async function GET() {\r\n    try {\r\n        // A simple query to check the connection\r\n        const result = await executeQuery('SELECT 1 as connected, GETDATE() as currentTime');\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: 'Database connection successful',\r\n            data: result.recordset[0]\r\n        });\r\n    } catch (error: any) {\r\n        console.error('Database connection error:', error);\r\n        return NextResponse.json({\r\n            success: false,\r\n            message: 'Database connection failed',\r\n            error: error.message\r\n        }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEO,eAAe;IAClB,IAAI;QACA,yCAAyC;QACzC,MAAM,SAAS,MAAM,IAAA,+LAAY,EAAC;QAClC,OAAO,gTAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;YACT,MAAM,OAAO,SAAS,CAAC,EAAE;QAC7B;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gTAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;YACT,OAAO,MAAM,OAAO;QACxB,GAAG;YAAE,QAAQ;QAAI;IACrB;AACJ"}}]
}